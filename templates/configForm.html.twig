<!-- https://codeberg.org/QuinQuies/glpisaml/issues/13 -->
{% import glpi_tpl_macro as fields %}

<!-- styling options for macro
    'label_class': "",
    'input_class': "",
    'field_class' : ""
-->

<script>
    // Remember tab state
    $(function() {
        $('a[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
            localStorage.setItem('lastTab', $(this).attr('href'));
        });
        var lastTab = localStorage.getItem('lastTab');
        
        if (lastTab) {
            $('[href="' + lastTab + '"]').tab('show');
        }
    });
    // Clipboard function
    function copyClip(key) {
        // Get the text field
        var copyText = document.getElementById(key);
        // Select the text field
        copyText.select();
        copyText.setSelectionRange(0, 99999); // For mobile devices
        // Copy the text inside the text field
        navigator.clipboard.writeText(copyText.value);
        // Alert the copied text
        alert("Succesfully copied the value: " + copyText.value + " to your clipboard.");
    }
</script>
<!-- Show config support or not 
{%if inputfields.debug.value == false %}
<style>
    .explanation {
        display:none;
    }
</style>
{%endif %}
-->

<form name="form" method="post" action="{{ glpi_rootdoc }}" id="phpsaml_config">
<div class="phpsaml_config_wrapper" id="samlForm">
    <input type="hidden" name="{{ inputfields.id.field }}" value="{{ inputfields.id.value }}">

    <div class="card" style="min-height:100%;">
        <!-- Input fields -->
        <ul class="nav nav-tabs" id="samlTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" 
                   id="general-tab" 
                   data-bs-toggle="tab" 
                   href="#general" 
                   data-bs-target="#general" 
                   type="button" role="tab" 
                   aria-controls="general" 
                   aria-selected="true"><b>{{ header_general }} {{ general_warning }}</b></a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" 
                   id="general-tab" 
                   data-bs-toggle="tab" 
                   href="#transit" 
                   data-bs-target="#transit" 
                   type="button" 
                   role="tab" 
                   aria-controls="transit" 
                   aria-selected="true"><b>{{ header_transit }} {{ header_warning }}</b></a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" 
                   id="provider-tab" 
                   data-bs-toggle="tab" 
                   href="#provider" 
                   data-bs-target="#provider" 
                   type="button" 
                   role="tab" 
                   aria-controls="provider" 
                   aria-selected="false"><b>{{ header_provider }} {{ provider_warning }}</b></a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" 
                   id="idp-tab" 
                   data-bs-toggle="tab" 
                   href="#idp" 
                   data-bs-target="#idp" 
                   type="button" 
                   role="tab" 
                   aria-controls="idp" 
                   aria-selected="false"><b>{{ header_idp }} {{ idp_warning }}</b></a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" 
                   id="security-tab" 
                   data-bs-toggle="tab" 
                   href="#security" 
                   data-bs-target="#security" 
                   type="button" 
                   role="tab" 
                   aria-controls="security" 
                   aria-selected="false"><b>{{ header_security }} {{ security_warning }}</b></a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" 
                   id="logging-tab" 
                   data-bs-toggle="tab" 
                   href="#logging" 
                   data-bs-target="#logging" 
                   type="button" 
                   role="tab" 
                   aria-controls="logging" 
                   aria-selected="false"><b>{{ header_logging }} {{ logging_warning }}</b></a>
            </li>
        </ul>
        <div class="tab-content flex-fill glpisaml" id="myTabContent">
            <!-- ################################################################################-->
            <!-- General details -->
            <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                <div class="card-body">
                    <div class="row g-2">
                        <!-- name field -->
                        <div class="col-12 col-sm-6">
                            {{ fields.textField(
                                inputfields.name.field, 
                                inputfields.name.value, 
                                inputfields.name.formtitle, 
                                {
                                    'required':true,
                                }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.name.formexplain }}</i>
                                    {% if inputfields.name.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.name.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- domain field -->
                        <div class="col-12 col-sm-6">
                            {{ fields.textField(
                                inputfields.conf_domain.field, 
                                inputfields.conf_domain.value, 
                                inputfields.conf_domain.formtitle, 
                                {
                                    'required':false,
                                }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.conf_domain.formexplain }}</i>
                                    {% if inputfields.conf_domain.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.conf_domain.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                   
                        <!-- icon field -->
                        <div class="col-12 col-sm-6">
                            {{ fields.textField(
                                inputfields.conf_icon.field, 
                                inputfields.conf_icon.value, 
                                inputfields.conf_icon.formtitle, 
                                {
                                    'required':true,
                                }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.conf_icon.formexplain }}</i>
                                    {% if inputfields.conf_icon.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.conf_icon.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Comment field -->
                        <div class="col-12 col-sm-6">
                            {{ fields.textareaField(
                                inputfields.comment.field, 
                                inputfields.comment.value, 
                                inputfields.comment.formtitle, 
                                {
                                    'required':false,
                                }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <!-- <i>{{ inputfields.comment.formexplain }}</i> --> 
                                    {% if inputfields.comment.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.comment.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                         <!-- enabled -->
                         <div class="col-12 col-sm-6">
                            {{ fields.sliderField(
                                inputfields.is_active.field,
                                inputfields.is_active.value,
                                inputfields.is_active.formtitle,
                               {
                                  inputOptionsBool
                               }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.is_active.formexplain }}</i>
                                    {% if inputfields.is_active.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.is_active.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Debug mode -->
                        <div class="col-12 col-sm-6">
                            {{ fields.sliderField(
                                inputfields.debug.field,
                                inputfields.debug.value,
                                inputfields.debug.formtitle,
                               {
                                  inputOptionsBool
                               }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.debug.formexplain }}</i>
                                    {% if inputfields.debug.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.debug.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ################################################################################-->
            <!-- transit tab -->
            <div class="tab-pane fade show" id="transit" role="tabpanel" aria-labelledby="transit-tab">
                <div class="card-body">
                    <div class="row g-2">

                        <!-- compress_requests -->
                        <div class="col-12 col-sm-6">
                            {{ fields.sliderField(
                                inputfields.compress_requests.field,
                                inputfields.compress_requests.value,
                                inputfields.compress_requests.formtitle,
                               {
                                  inputOptionsBool
                               }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.compress_requests.formexplain }}</i>
                                    {% if inputfields.compress_requests.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.compress_requests.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- compress_responses -->
                        <div class="col-12 col-sm-6">
                            {{ fields.sliderField(
                                inputfields.compress_responses.field,
                                inputfields.compress_responses.value,
                                inputfields.compress_responses.formtitle,
                               {
                                  inputOptionsBool
                               }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.compress_responses.formexplain }}</i>
                                    {% if inputfields.compress_responses.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.compress_responses.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- enforce SSO -->
                        <div class="col-12 col-sm-6">
                            {{ fields.sliderField(
                                inputfields.proxied.field,
                                inputfields.proxied.value,
                                inputfields.proxied.formtitle,
                               {
                                  inputOptionsBool
                               }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.proxied.formexplain }}</i>
                                    {% if inputfields.proxied.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.proxied.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- validate_xml -->
                        <div class="col-12 col-sm-6">
                            {{ fields.sliderField(
                                inputfields.validate_xml.field,
                                inputfields.validate_xml.value,
                                inputfields.validate_xml.formtitle,
                               {
                                  inputOptionsBool
                               }
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.validate_xml.formexplain }}</i>
                                    {% if inputfields.validate_xml.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.validate_xml.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- validate_destination -->
                        <div class="col-12 col-sm-6">
                            {{ fields.sliderField( 
                                inputfields.validate_destination.field, 
                                inputfields.validate_destination.value, 
                                inputfields.validate_destination.formtitle, 
                                { inputOptionsBool } 
                            ) }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.validate_destination.formexplain }}</i>
                                    {% if inputfields.validate_destination.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.validate_destination.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- lowercase_url_encoding -->
                        <div class="col-12 col-sm-6">
                            {{ fields.sliderField( 
                                inputfields.lowercase_url_encoding.field, 
                                inputfields.lowercase_url_encoding.value, 
                                inputfields.lowercase_url_encoding.formtitle, 
                                { inputOptionsBool }) 
                            }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.lowercase_url_encoding.formexplain }}</i>
                                    {% if inputfields.lowercase_url_encoding.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.lowercase_url_encoding.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- ################################################################################-->
            <div class="tab-pane fade" id="provider" role="tabpanel" aria-labelledby="provider-tab">
                <div class="card-body">

                    <!-- Service provider details -->
                    <div class="col-12 col-sm-6">
                        <!-- Entity ID -->
                        {{ fields.textField('EntityID', entityID, 'Entity ID',
                            {
                                'id': 'EntityId',
                                'disabled':true,
                            }
                        ) }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7 field-container">
                                <a class='btn btn-ghost-info' onclick="copyClip('EntityId')">Copy Entity Id to clipboard</a>
                            </div>
                        </div>
                        <!-- Meta URL -->
                        {{ fields.textField('MetaUrl', metaUrl, 'MetaUrl',
                            {
                                'id': 'MetaUrl',
                                'disabled':true,
                            }
                        ) }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7 field-container">
                                <a class='btn btn-ghost-info' onclick="copyClip('MetaUrl')">Copy Meta Url to clipboard</a>
                            </div>
                        </div>
                       
                        {{ fields.textField('AcsUrl', acsUrl, 'AcsUrl',
                            {
                                'id': 'AcsUrl',
                                'disabled':true,
                            }
                        ) }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7 field-container">
                                <a class='btn btn-ghost-info' onclick="copyClip('AcsUrl')">Copy ACS Url to clipboard</a>
                            </div>
                        </div>
                    </div>

                    <!-- sp_certificate -->
                    <div class="col-12 col-sm-6">
                        {{ fields.textareaField(
                            inputfields.sp_certificate.field,
                            inputfields.sp_certificate.value,
                            inputfields.sp_certificate.formtitle,
                            {}) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7 field-container">
                                <i>{{ inputfields.sp_certificate.formexplain }}</i>
                            </div>
                        </div>
                    </div>

                    <!-- sp_private_key -->
                    <div class="col-12 col-sm-6">
                        {{ fields.textareaField( 
                            inputfields.sp_private_key.field,
                            inputfields.sp_private_key.value,
                            inputfields.sp_private_key.formtitle,
                            {}) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.sp_private_key.formexplain }}</i>
                                {% if inputfields.sp_private_key.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.sp_private_key.errors }}</div>
                                {% endif %}
                                {% if inputfields.sp_certificate.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.sp_certificate.errors }}</div>
                                {% endif %}
                                {% if inputfields.sp_certificate.validate.subject.CN == true %}
                                    <div id="textHelper" class="form-text" style="color:rgb(71, 180, 8);">🆗 Valid certificate found: {{ inputfields.sp_certificate.validate.subject.CN }}</div>
                                {% endif %}
                                {% if inputfields.sp_certificate.validate.validations.validTo == true %}
                                    <div id="textHelper" class="form-text" style="color:rgb(180, 120, 8);">{{ inputfields.sp_certificate.validate.validations.validTo }}</div>
                                {% endif %}
                                {% if inputfields.sp_certificate.validate.validations.validFrom == true %}
                                    <div id="textHelper" class="form-text" style="color:rgb(180, 120, 8);">{{ inputfields.sp_certificate.validate.validations.validFrom }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12 col-sm-6">
                        {{ fields.dropdownArrayField(
                            inputfields.sp_nameid_format.field,
                            inputfields.sp_nameid_format.value,
                            inputOptionsNameFormat,
                            inputfields.sp_nameid_format.formtitle,
                            {}
                        ) }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.sp_nameid_format.formexplain }}</i>
                                {% if inputfields.sp_nameid_format.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.sp_nameid_format.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>


                </div>
            </div>

            <!-- ################################################################################-->
            <!-- Identity provider details -->
            <div class="tab-pane fade" id="idp" role="tabpanel" aria-labelledby="idp-tab">
                <div class="card-body">
                     <!-- idp_entity_id -->
                     <div class="col-12 col-sm-6">
                        {{ fields.textField( 
                            inputfields.idp_entity_id.field, 
                            inputfields.idp_entity_id.value, 
                            inputfields.idp_entity_id.formtitle, 
                            {}) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.idp_entity_id.formexplain }}</i>
                                {% if inputfields.idp_entity_id.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.idp_entity_id.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- idp_single_sign_on_service -->
                    <div class="col-12 col-sm-6">
                        {{ fields.textField( 
                            inputfields.idp_single_sign_on_service.field, 
                            inputfields.idp_single_sign_on_service.value, 
                            inputfields.idp_single_sign_on_service.formtitle, 
                            {}) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.idp_single_sign_on_service.formexplain }}</i>
                                {% if inputfields.idp_single_sign_on_service.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.idp_single_sign_on_service.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- idp_single_logout_service -->
                    <div class="col-12 col-sm-6">
                        {{ fields.textField( 
                            inputfields.idp_single_logout_service.field, 
                            inputfields.idp_single_logout_service.value, 
                            inputfields.idp_single_logout_service.formtitle, 
                            {}) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.idp_single_logout_service.formexplain }}</i>
                                {% if inputfields.idp_single_logout_service.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.idp_single_logout_service.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- idp_certificate -->
                    <div class="col-12 col-sm-6">
                        {{ fields.textareaField(
                            inputfields.idp_certificate.field,
                            inputfields.idp_certificate.value,
                            inputfields.idp_certificate.formtitle,
                            {}) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.idp_certificate.formexplain }}</i>
                                {% if inputfields.idp_certificate.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.idp_certificate.errors }}</div>
                                {% endif %}
                                {% if inputfields.idp_certificate.validate.subject.CN == true %}
                                    <div id="textHelper" class="form-text" style="color:rgb(71, 180, 8);">🆗 Valid Certificate found: {{ inputfields.idp_certificate.validate.subject.CN }}</div>
                                {% endif %}
                                {% if inputfields.idp_certificate.validate.validations.validTo == true %}
                                    <div id="textHelper" class="form-text" style="color:rgb(180, 140, 8);">{{ inputfields.idp_certificate.validate.validations.validTo }}</div>
                                {% endif %}
                                {% if inputfields.idp_certificate.validate.validations.validFrom == true %}
                                    <div id="textHelper" class="form-text" style="color:rgb(180, 140, 8);">{{ inputfields.idp_certificate.validate.validations.validFrom }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- requested_authn_context -->
                    <div class="col-12 col-sm-6">
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end">
                                <label for="{{ inputfields.requested_authn_context.field }}">{{ inputfields.requested_authn_context.formtitle }}</label>
                            </div>
                            <div class="col-xxl-7  field-container">
                                <select id="keep-order" multiple="multiple" aria-label="multiple select" name="{{ inputfields.requested_authn_context.field }}[]">
                                    {% for key, authn in inputOptionsAuthnContext %}
                                            {%set selected = false %}
                                            {% for value in inputfields.requested_authn_context.value %}
                                                {% if value == key %}
                                                    {% set selected = 'selected' %}
                                                {% endif %}
                                            {% endfor %}
                                                <option {{ selected }} value="{{ key }}">{{ authn }}</option>
                                        {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.requested_authn_context.formexplain }}</i>
                                {% if inputfields.requested_authn_context.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.requested_authn_context.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- requested_authn_context -->
                    <div class="col-12 col-sm-6">
                        {{ fields.dropdownArrayField(
                            inputfields.requested_authn_context_comparison.field,
                            inputfields.requested_authn_context_comparison.value,
                            inputOptionsAuthnCompare,
                            inputfields.requested_authn_context_comparison.formtitle,
                            {}
                        ) }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                {% if inputfields.requested_authn_context_comparison.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.requested_authn_context_comparison.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- ################################################################################-->
            <!-- Security details -->
            <div class="tab-pane fade" id="security" role="tabpanel" aria-labelledby="idp-tab">
                <div class="card-body">
                    <!-- 2 row configuration -->
                    <div class="row g-2"> 

                    <!-- enforce SSO -->
                    <div class="col-12 col-sm-6">
                        {{ fields.sliderField(
                            inputfields.enforce_sso.field,
                            inputfields.enforce_sso.value,
                            inputfields.enforce_sso.formtitle,
                           { inputOptionsBool }) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.enforce_sso.formexplain }}</i>
                                {% if inputfields.enforce_sso.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.enforce_sso.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Strict mode -->
                    <div class="col-12 col-sm-6">
                        {{ fields.sliderField(
                            inputfields.strict.field,
                            inputfields.strict.value,
                            inputfields.strict.formtitle,
                           { inputOptionsBool }) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.strict.formexplain }}</i>
                                {% if inputfields.strict.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.strict.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- User JIT -->
                    <div class="col-12 col-sm-6">
                        {{ fields.sliderField(
                            inputfields.user_jit.field,
                            inputfields.user_jit.value,
                            inputfields.user_jit.formtitle,
                           { inputOptionsBool }) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.user_jit.formexplain }}</i>
                                {% if inputfields.user_jit.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.user_jit.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- security_nameidencrypted -->
                    <div class="col-12 col-sm-6">
                        {{ fields.sliderField(
                            inputfields.security_nameidencrypted.field,
                            inputfields.security_nameidencrypted.value,
                            inputfields.security_nameidencrypted.formtitle,
                            { inputOptionsBool }) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.security_nameidencrypted.formexplain }}</i>
                                {% if inputfields.security_nameidencrypted.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.security_nameidencrypted.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    

                    <!-- security_authnrequestssigned -->
                    <div class="col-12 col-sm-6">
                        {{ fields.sliderField(
                            inputfields.security_authnrequestssigned.field,
                            inputfields.security_authnrequestssigned.value,
                            inputfields.security_authnrequestssigned.formtitle,
                            { inputOptionsBool }) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.security_authnrequestssigned.formexplain }}</i>
                                {% if inputfields.security_authnrequestssigned.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.security_authnrequestssigned.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                        

                    <!-- security_authnrequestssigned -->
                    <div class="col-12 col-sm-6">
                        {{ fields.sliderField(
                            inputfields.security_logoutrequestsigned.field,
                            inputfields.security_logoutrequestsigned.value,
                            inputfields.security_logoutrequestsigned.formtitle,
                            { inputOptionsBool }) 
                        }}
                        <div class="form-field row col-12 col-sm-6  mb-2">
                            <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                            <div class="col-xxl-7  field-container">
                                <i>{{ inputfields.security_logoutrequestsigned.formexplain }}</i>
                                {% if inputfields.security_logoutrequestsigned.errors == true %}
                                    <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.security_logoutrequestsigned.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
    
                    

                        <!-- security_authnrequestssigned -->
                        <div class="col-12 col-sm-6">
                            {{ fields.sliderField(
                                inputfields.security_logoutresponsesigned.field,
                                inputfields.security_logoutresponsesigned.value,
                                inputfields.security_logoutresponsesigned.formtitle,
                                { inputOptionsBool }) 
                            }}
                            <div class="form-field row col-12 col-sm-6  mb-2">
                                <div class="col-form-label col-xxl-5 text-xxl-end"></div>
                                <div class="col-xxl-7  field-container">
                                    <i>{{ inputfields.security_logoutresponsesigned.formexplain }}</i>
                                    {% if inputfields.security_logoutresponsesigned.errors == true %}
                                        <div id="textHelper" class="form-text" style="color:red;">{{ inputfields.security_logoutresponsesigned.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        
                    </div>
                </div>
            </div>
            <!-- ################################################################################-->
            <!-- Security details -->
            <div class="tab-pane fade" id="logging" role="tabpanel" aria-labelledby="idp-tab">
                <div class="card-body">
                    <div class="row g-2">      
                        <!-- enforce SSO -->
                        <div class="col-md p-2">
                            <h2>Work in progress, logging is by no means complete but still usable</h2>
                            <div>Phases: 1 = initial, 2=received_saml_response_acs, 3=performed_saml_auth, 4=performed_glpi_auth, 5=file_exclude, 6=forced_logoff, 7=timed_out, 8=manual_glpi_logout
                            </div>
                            <table class="table table-striped table-sm">
                                <thead>
                                  <tr>
                                    <th scope="col">Id</th>
                                    <th scope="col">IdpId</th>
                                    <th scope="col">username</th>
                                    <th scope="col">glpiAuthed</th>
                                    <th scope="col">samlAuthed</th>
                                    <th scope="col">Phase</th>
                                    <th scope="col">Location</th>
                                    <th scope="col">loginTime</th>
                                    <th scope="col">lastClickTime</th>
                                  </tr>
                                </thead>
                                {% for logrow in loggingfields %}
                                <tr>
                                    <td scope="col">{{ logrow.id }}</td>
                                    <td scope="col">{{ logrow.idpId }}</td>
                                    <td scope="col">{{ logrow.userName }}</td>
                                    <td scope="col">{{ logrow.glpiAuthed }}</td>
                                    <td scope="col">{{ logrow.samlAuthed }}</td>
                                    <td scope="col">{{ logrow.phase }}</td>
                                    <td scope="col">{{ logrow.location }}</td>
                                    <td scope="col">{{ logrow.loginTime }}</td>
                                    <td scope="col">{{ logrow.lastClickTime }}</td>
                                </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card itil-footer" style="margin-top:10px;">
        <div class="form-buttons col-lg d-flex ms-auto ms-lg-0 flex-row-reverse p-1 ">
            <div class="m-1">
                <button class="btn btn-primary " type="submit" name="update" title="Save">
                    <i class="far fa-save"></i>
                    <span class="d-none d-xl-block">{{ submit }}</span>
                    </button>
            </div>
            <div class="m-1">
                <button class="btn btn-ghost-danger" type="submit" name="delete" title="" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Put in trashbin">
                    <i class="ti ti-trash"></i>
                    <span class="d-none d-xl-block">{{ delete }}</span>
                    </button>
            </div>
            {% if inputfields.debug.value == true %}
            <div class="m-1 align-middle text-muted pull-left pt-2">
                <a href="{{ LatestVersion.gitUrl }}" target="_blank">Repo version: {{ LatestVersion.gitVersion }} your version: v{{ LatestVersion.currentVersion }}</a> ⚠️ Warning SP metadata exposed! - ROWID: {{ inputfields.id.value }} | CREATED DATE: {{ inputfields.date_creation.value }} | LAST UPDATED: {{ inputfields.date_mod.value }}
            {% endif %}
        </div>
    </div>
</div>
{{ close_form|raw }}
